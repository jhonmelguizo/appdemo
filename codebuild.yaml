steps:
  # Clonar el repositorio de código desde GitHub
  - name: 'gcr.io/cloud-builders/git'
    args: ['clone', 'https://github.com/jhonmelguizo/appdemo', '/workspace']
    
  # Obtener el valor de $COMMIT_SHA
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['source', 'repos', 'describe', 'appdemo', '--format', 'value(headSha)']
    id: get_commit_sha
    
  # Construir la imagen de Docker usando la etiqueta dinámica
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/pr1-jamc-gcp/app-demo/appdemo:$COMMIT_SHA', '.']
    dir: '/workspace'
    
  # Push de la imagen a Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/pr1-jamc-gcp/app-demo/appdemo:$COMMIT_SHA']

images:
  # Registrar la imagen en Container Registry
  - 'gcr.io/pr1-jamc-gcp/app-demo/appdemo:$COMMIT_SHA'
